[오프닝]

약국 주제 데이터베이스 설계 진행
이유-> 자주 사용하는 공간, ~~ 유기적 연결 데이터베이스로 다루기 좋음

[개념 erd]
이번 디비 총 5개 테이블로 설계
설명 엔티티
약국 테이블 ~~
약품 테이블 ~~

이제 개념 erd를 보시면서 테이블 사이의 관계를 설명
한 명의 환자 -> 여러 번 병원(새로운 처방전)
하나의 처방전 -> 여러명 환자 x
일대다
하나의 약국 -> 여러 환자의 처방전
하나의 처방전 -> 여러 약국 x
일대 다

한장의 처방전 -> 여러가지 약
약 -> 여러개 처방전
다대 다
데이터 베이스에서는 직접 표현x -> 처방전_약품 중간 연결

약품 테이블은 모든 처방전에 공통 참조

[논리erd]
관계 그림 -> 큰구조
실제 어떤 칼럼들이 표 형태 구체화

환자테이블
환자번호 기본키, 처방전의 외래키로 연결
-> 환자 번호로 어떤 환자가 어떤 처방전을 받았는지 알 수 있음

약국 테이블
약국번호 기본키, 처방전의 외캐기로 연결
-> 어느 약국에서 처방전이 조제되었는지

처방전 테이블 
처방전 고유번호 기본기, 환자번호,약국번호 외래키로 참조
처방전 고유번호는 처방전 약품 테이블의 외래키로 연결
어떤 약들이 그 처방전에 포함됐는지 확인

처방전_약국 테이블 처방전 고유번호와 약품 번호를 복합 기본키로 사용
외래키로 처방전 고유번호랑 약품번호를 동시 참조

약품 테이블은 약품번호 기본키고 이 번호가 처방전 약품 외래키로 참조

환자번호 -> 처방전
약국번호 -> 처방전
처방전 고유번호와 약품번호는 처방전_약품테이블을 통해 연결 

[물리 erd]
어떤 자료형을 가졌는지

환자테이블
환자번호 바차투 십
이름 사람마다 달라 바타투 오십
생년월일 날짜 연산이 필요하기 때문에 데이트
성별은 한 글자 값만 들어가므로 찰 1
주소는 길 수 있으니 바타 투 100

약국테이블
약국번호 바차투 십
약국 이름 바차투 15
주소 바차투 100
전화번호 숫자연산 필요x 바차투20

처방전테이블
처방전 번호 바차투10
발급일자 날짜검색 데이트
환자번호, 약국번호 참조키 바차투 10
질병명은 간단하게 바차투 20
비고 짧은 메모 바차투 50

약품테이블
약품번호 바차투10
약품명 바차투100
제조사 바차투 30
분류 바차투 30
금액 넘버(10,2)

처방전 _약품 테이블
처방전 번호, 약품 번호 두개 합쳐서 기본키이자 외래키로 사용
나머지 정수값 number

[구현]

-테이블 생성 -> 데이터무결성 보장을 위해 제약조건

환자테이블
환자번호 기본키
이름 반드시 입력 not null
전화번호 중복 허용 안됨 유니크제약
성별은 m이나f만 들어가도록 체크제약

약품테이블
약품번호 기본키
약품 이름 반드시 입력
가격은 음수가 들어가면 안되니까 체크 프라이스 0보다 크다 조건

약국 테이블은
약국 아이디를 기본키
약국 번호를 유니크 제약을 건다

처방전 테이블은 더 복잡
처방전 고유번호를 기본키
발급일자는 반드시 있어야해서 not null
환자번호와 약국번호는 외래키로 참조

처방전_약품 테이블
처방전 번호랑 약품 번호 두개를 합쳐서 복합 기본키로 설정
1회투여량,1일횟수, 총 일수는 check 제약을 걸어 모두 0 이상이 되도록 함
처방전 번호와 약품번호는 외래키 참조 연결

-테이블 변경
크리에이트문 -> 테이블 생성
알터문->테이블 수정 
앞에서 환자 테이블을 보면 생년월일은 단순히 데이트 타입으로만 지정 
값을 입력하지 않으면 null값이 나옴
그래서 알터문 사용해 생년월일의 기본값이 현재 시간으로 나오도록 설정

데이터 입력할 때 생년월일을 입력하지 않아도 자동으로 현재 날짜가 기본값으로 들어감

[데이터 조회]
생성된 테이블들을 이용해서 원하는 데이터를 조회해보도록 함

-환자정보 조회
먼저 환자정보를 조회해보도록 함
환자테이블에서 
환자이름과 생년월일 
나이는 현재시간에서 생년월일 사이의 개월 수를 구해 12로 나눈뒤 소수점을 버리고 뒤에 '세'를 붙여서 보이게 함
연락처와
성별은 디코드 함수를 사용해서 젠더 값이 m이면 남 f면 여 나머지는 -로 표시한다.

결과 화면을 보면 환자 정보가 한눈에 보임

-약국정보조회
다음은 약국정보를 조회
약국테이블에서
약국명,연락처,주소를 출력하고 
지역_분류는 
약국번호에서 첫글자부터 첫 하이픈 앞까지를 잘라서
02->서울
031->경기도
051->부산
그 외에는 기타라고 표시함

전화번호 패턴으로 약국의 지역을 자동으로 분류해준다

결과 화면을 보면 지역별 약국 정보를 한눈에 확인 가능 

-약품별 평균 복용일수와 최대복용일수 

약품테이블과 처방전_약품테이블을 아이디로 조인하고 
약픔 이름으로 조인함 
